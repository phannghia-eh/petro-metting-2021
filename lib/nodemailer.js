const nodemailer = require('nodemailer')

class Mailer {
    static transporter() {
        return nodemailer.createTransport({
            // host: "in-v3.mailjet.com",
            host: "smtp.gmail.com",
            port: 587,
            secure: false,
            auth: {
                // user: '2e766df5fa52e0a23a4d029d2fd06378', // phn1910@gmail.com mailjet
                // user: '53cf9000f2688d5e5f432e13c9ac6fe8', // hoi nghi nguoi lao dong mailjet
                user: 'hoi.nghi.nguoi.lao.dong.12.2021@gmail.com', // phn1910@gmail.com gmail
                // pass: 'fbff24ea09da7f14040add8d96a4aa3a'
                // pass: 'c4d390e682f5dc20c18923e6260d5766'
                pass: 'jbzlhihmtrpotzbj'
            },
        });
    }

    static successMailTemplate(name, title) {
        return `
<!doctype html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office"><head><title>Thư mời tham dự "Hội nghị người lao động 2021"</title><!--[if !mso]>
<!--><meta http-equiv="X-UA-Compatible" content="IE=edge"><!--
	<![endif]--><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style type="text/css">#outlook a{padding:0}body{margin:0;padding:0;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}table,td{border-collapse:collapse;mso-table-lspace:0;mso-table-rspace:0}img{border:0;height:auto;line-height:100%;outline:0;text-decoration:none;-ms-interpolation-mode:bicubic}p{display:block;margin:13px 0}</style><!--[if mso]><noscript><xml><o:officedocumentsettings><o:allowpng><o:pixelsperinch>96</o:pixelsperinch></o:officedocumentsettings></xml></noscript><![endif]--><!--[if lte mso 11]><style type="text/css">.mj-outlook-group-fix{width:100%!important}</style><![endif]--><!--[if !mso]>
			<!--><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet" type="text/css"><link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700" rel="stylesheet" type="text/css"><style type="text/css">@import url(https://fonts.googleapis.com/css?family=Roboto:300,400,500,700);@import url(https://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700);</style><!--
					<![endif]--><style type="text/css">@media only screen and (min-width:480px){.mj-column-per-67{width:67%!important;max-width:67%}.mj-column-per-33{width:33%!important;max-width:33%}.mj-column-per-100{width:100%!important;max-width:100%}}</style><style media="screen and (min-width:480px)">.moz-text-html .mj-column-per-67{width:67%!important;max-width:67%}.moz-text-html .mj-column-per-33{width:33%!important;max-width:33%}.moz-text-html .mj-column-per-100{width:100%!important;max-width:100%}</style><style type="text/css">[owa] .mj-column-per-67{width:67%!important;max-width:67%}[owa] .mj-column-per-33{width:33%!important;max-width:33%}[owa] .mj-column-per-100{width:100%!important;max-width:100%}</style><style type="text/css"></style></head><body style="word-spacing:normal;background-color:#f6ffe0"><div style="background-color:#f6ffe0"><!--[if mso | IE]><table align="center" border="0" cellpadding="0" cellspacing="0" class="" role="presentation" style="width:600px" width="600"><tr><td style="line-height:0;font-size:0;mso-line-height-rule:exactly"><![endif]--><div style="margin:0 auto;max-width:600px"><table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width:100%"><tbody><tr><td style="direction:ltr;font-size:0;padding:20px 0;padding-bottom:20px;padding-top:20px;text-align:center"><!--[if mso | IE]><table role="presentation" border="0" cellpadding="0" cellspacing="0"><tr><td class="" style="vertical-align:top;width:600px"><![endif]--><div class="mj-column-per-100 mj-outlook-group-fix" style="font-size:0;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%"><table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top" width="100%"><tbody></tbody></table></div><!--[if mso | IE]><![endif]--></td></tr></tbody></table></div><!--[if mso | IE]><table align="center" border="0" cellpadding="0" cellspacing="0" class="" role="presentation" style="width:600px" width="600" bgcolor="transparent"><tr><td style="line-height:0;font-size:0;mso-line-height-rule:exactly"><![endif]--><div style="background:0 0;background-color:transparent;margin:0 auto;max-width:600px"><table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="background:0 0;background-color:transparent;width:100%"><tbody><tr><td style="direction:ltr;font-size:0;padding:40px 0 40px 0;padding-bottom:40px;padding-left:0;padding-right:0;padding-top:40px;text-align:center"><!--[if mso | IE]><table role="presentation" border="0" cellpadding="0" cellspacing="0"><tr><td class="" style="vertical-align:top;width:600px"><![endif]--><div class="mj-column-per-100 mj-outlook-group-fix" style="font-size:0;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%"><table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top" width="100%"><tbody><tr><td align="left" style="font-size:0;padding:10px 25px;padding-top:10px;padding-bottom:0;word-break:break-word"><div style="font-family:Arial,sans-serif;font-size:13px;letter-spacing:normal;line-height:1;text-align:left;color:#000"><h2 class="text-build-content" style="text-align:center;margin-top:10px;font-weight:400" data-testid="5rppXGYeeR"><span style="color:#0cf;font-family:Roboto;font-size:32px;line-height:30px">Thư mời tham dự</span></h2><h1 class="text-build-content" style="text-align:center;margin-bottom:10px;font-weight:400" data-testid="5rppXGYeeR"><span style="color:#0cf;font-family:Roboto;font-size:38px;line-height:30px">Hội nghị người lao động 2021</span></h1></div></td></tr><tr><td align="center" vertical-align="middle" style="background:0 0;font-size:0;padding:20px 25px 10px 25px;padding-top:20px;padding-right:25px;padding-left:25px;word-break:break-word"><table border="0" cellpadding="0" cellspacing="0" role="presentation" style="border-collapse:separate;line-height:100%"><tbody><tr><td align="center" bgcolor="#00ccff" role="presentation" style="border:none;border-radius:30px;cursor:auto;mso-padding-alt:10px 25px 10px 25px;background:#0cf" valign="middle"><p href="" style="display:inline-block;background:#0cf;color:#fff;font-family:Arial,sans-serif;font-size:13px;font-weight:400;line-height:120%;margin:0;text-decoration:none;text-transform:none;padding:10px 25px 10px 25px;mso-padding-alt:0;border-radius:30px"><span style="background-color:transparent;color:#fff;font-family:Arial;font-size:13px">Bấm để tham gia buổi họp</span></p></td></tr></tbody></table></td></tr></tbody></table></div><!--[if mso | IE]><![endif]--></td></tr></tbody></table></div><!--[if mso | IE]><table align="center" border="0" cellpadding="0" cellspacing="0" class="" role="presentation" style="width:600px" width="600" bgcolor="#ffffff"><tr><td style="line-height:0;font-size:0;mso-line-height-rule:exactly"><![endif]--><div style="background:#fff;background-color:#fff;margin:0 auto;max-width:600px"><table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="background:#fff;background-color:#fff;width:100%"><tbody><tr><td style="direction:ltr;font-size:0;padding:20px 0;text-align:center"><!--[if mso | IE]><table role="presentation" border="0" cellpadding="0" cellspacing="0"><tr><td class="" style="vertical-align:top;width:600px"><![endif]--><div class="mj-column-per-100 mj-outlook-group-fix" style="font-size:0;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%"><table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top" width="100%"><tbody><tr><td align="left" style="font-size:0;padding:10px 25px;padding-top:0;padding-bottom:0;word-break:break-word"><div style="font-family:Arial,sans-serif;font-size:13px;letter-spacing:normal;line-height:1;text-align:left;color:#000"><p class="text-build-content" data-testid="7m0I-YxI_1a" style="margin:10px 0;margin-top:10px">Vui lòng đặt tên tham dự theo cú pháp:&nbsp;</p><p class="text-build-content" data-testid="7m0I-YxI_1a" style="margin:10px 0">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;[Họ tên] - [Chức vụ]</p><p class="text-build-content" data-testid="7m0I-YxI_1a" style="margin:10px 0">Ví dụ: họ tên: ${name}, chức vụ: ${title}</p><p class="text-build-content" data-testid="7m0I-YxI_1a" style="margin:10px 0;margin-bottom:10px">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;${name} - ${title}</p></div></td></tr></tbody></table></div><!--[if mso | IE]><![endif]--></td></tr></tbody></table></div></div></body></html>
`
    }

    static failMailTemplate() {
        return `
        <!doctype html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office"><head><title>Thư mời tham dự "Hội nghị người lao động 2021"</title><!--[if !mso]>
<!--><meta http-equiv="X-UA-Compatible" content="IE=edge"><!--
\t<![endif]--><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><style type="text/css">#outlook a{padding:0}body{margin:0;padding:0;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}table,td{border-collapse:collapse;mso-table-lspace:0;mso-table-rspace:0}img{border:0;height:auto;line-height:100%;outline:0;text-decoration:none;-ms-interpolation-mode:bicubic}p{display:block;margin:13px 0}</style><!--[if mso]><noscript><xml><o:officedocumentsettings><o:allowpng><o:pixelsperinch>96</o:pixelsperinch></o:officedocumentsettings></xml></noscript><![endif]--><!--[if lte mso 11]><style type="text/css">.mj-outlook-group-fix{width:100%!important}</style><![endif]--><style type="text/css">@media only screen and (min-width:480px){.mj-column-per-67{width:67%!important;max-width:67%}.mj-column-per-33{width:33%!important;max-width:33%}.mj-column-per-100{width:100%!important;max-width:100%}}</style><style media="screen and (min-width:480px)">.moz-text-html .mj-column-per-67{width:67%!important;max-width:67%}.moz-text-html .mj-column-per-33{width:33%!important;max-width:33%}.moz-text-html .mj-column-per-100{width:100%!important;max-width:100%}</style><style type="text/css">[owa] .mj-column-per-67{width:67%!important;max-width:67%}[owa] .mj-column-per-33{width:33%!important;max-width:33%}[owa] .mj-column-per-100{width:100%!important;max-width:100%}</style><style type="text/css"></style></head><body style="word-spacing:normal;background-color:#f6ffe0"><div style="background-color:#f6ffe0"><!--[if mso | IE]><table align="center" border="0" cellpadding="0" cellspacing="0" class="" role="presentation" style="width:600px" width="600"><tr><td style="line-height:0;font-size:0;mso-line-height-rule:exactly"><![endif]--><div style="margin:0 auto;max-width:600px"><table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width:100%"><tbody><tr><td style="direction:ltr;font-size:0;padding:20px 0 20px 0;text-align:center"><!--[if mso | IE]><table role="presentation" border="0" cellpadding="0" cellspacing="0"><tr><td class="" style="vertical-align:top;width:402px"><![endif]--><div class="mj-column-per-67 mj-outlook-group-fix" style="font-size:0;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%"><table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top" width="100%"><tbody><tr><td align="left" style="font-size:0;padding:0 0 0 25px;padding-top:0;padding-bottom:0;word-break:break-word"><div style="font-family:Arial,sans-serif;font-size:13px;letter-spacing:normal;line-height:1;text-align:left;color:#000"><p style="margin:10px 0"></p></div></td></tr></tbody></table></div></td></tr></tbody></table></div><!--[if mso | IE]><table align="center" border="0" cellpadding="0" cellspacing="0" class="" role="presentation" style="width:600px" width="600"><tr><td style="line-height:0;font-size:0;mso-line-height-rule:exactly"><![endif]--><div style="margin:0 auto;max-width:600px"><table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="width:100%"><tbody><tr><td style="direction:ltr;font-size:0;padding:20px 0;padding-bottom:20px;padding-top:20px;text-align:center"><!--[if mso | IE]><table role="presentation" border="0" cellpadding="0" cellspacing="0"><tr><td class="" style="vertical-align:top;width:600px"><![endif]--><div class="mj-column-per-100 mj-outlook-group-fix" style="font-size:0;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%"><table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top" width="100%"><tbody></tbody></table></div><!--[if mso | IE]><![endif]--></td></tr></tbody></table></div><!--[if mso | IE]><table align="center" border="0" cellpadding="0" cellspacing="0" class="" role="presentation" style="width:600px" width="600" bgcolor="#ffffff"><tr><td style="line-height:0;font-size:0;mso-line-height-rule:exactly"><![endif]--><div style="background:#fff;background-color:#fff;margin:0 auto;max-width:600px"><table align="center" border="0" cellpadding="0" cellspacing="0" role="presentation" style="background:#fff;background-color:#fff;width:100%"><tbody><tr><td style="direction:ltr;font-size:0;padding:20px 0;text-align:center"><!--[if mso | IE]><table role="presentation" border="0" cellpadding="0" cellspacing="0"><tr><td class="" style="vertical-align:top;width:600px"><![endif]--><div class="mj-column-per-100 mj-outlook-group-fix" style="font-size:0;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100%"><table border="0" cellpadding="0" cellspacing="0" role="presentation" style="vertical-align:top" width="100%"><tbody><tr><td align="left" style="font-size:0;padding:10px 25px;padding-top:0;padding-bottom:0;word-break:break-word"><div style="font-family:Arial,sans-serif;font-size:13px;letter-spacing:normal;line-height:1;text-align:left;color:#000"><p class="text-build-content" data-testid="7m0I-YxI_1a" style="margin:10px 0;margin-top:10px;margin-bottom:10px">Thông tin đăng ký của bạn không phù hợp với buổi họp, vui lòng liên hệ với phòng ban tổ chức để xác nhận lại thông tin</p></div></td></tr></tbody></table></div><!--[if mso | IE]><![endif]--></td></tr></tbody></table></div></div></body></html>
        `
    }

    static buildMail(content) {
        return {
            to: 'phn1910@gmail.com',
            subject: 'Thư mời tham dự cuộc họp tổng kết năm 2021',
            text: 'Thư mời tham dự cuộc họp',
            html: content
        }
    }

    static async sendMail(data) {
        return new Promise(async (resolve, reject) => {
            this.transporter().sendMail(this.buildMail(data), (err, info) => {
                if (err) return reject(err)
                return resolve(info)
            })
        })
    }

    static async sendSuccessMail(data) {
        console.log('SENT SUCCESS MAIL')
        return new Promise(async (resolve, reject) => {
            this.transporter().sendMail(this.buildMail(this.successMailTemplate(data.name, data.title)), (err, info) => {
                if (err) return reject(err)
                return resolve(info)
            })
        })
    }

    static async sendFailMail(data) {
        console.log('SENT FAIL MAIL')
        return new Promise(async (resolve, reject) => {
            this.transporter().sendMail(this.buildMail(this.failMailTemplate()), (err, info) => {
                if (err) return reject(err)
                return resolve(info)
            })
        })
    }
}

module.exports = Mailer